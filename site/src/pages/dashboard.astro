---
// Public no-auth demo dashboard. Data is demo-generated client-side.
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Example Dashboard — Logentica</title>
  </head>

  <body class="min-h-screen bg-zinc-950 text-zinc-100">
    <!-- Background texture -->
    <div class="pointer-events-none fixed inset-0">
      <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,rgba(255,255,255,0.10),transparent_55%)]"></div>
      <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_bottom,rgba(255,255,255,0.06),transparent_60%)]"></div>
      <div class="absolute inset-0 opacity-[0.07] [background-image:linear-gradient(rgba(255,255,255,0.08)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.08)_1px,transparent_1px)] [background-size:48px_48px]"></div>
    </div>

    <main class="relative mx-auto max-w-6xl px-5 py-10 sm:px-8">
      <!-- Top bar -->
      <header class="flex flex-col gap-6 sm:flex-row sm:items-start sm:justify-between">
        <div>
          <div class="flex items-center gap-3">
            <div class="h-9 w-9 rounded-xl border border-white/10 bg-white/5"></div>
            <div>
              <h1 class="mt-1 text-3xl font-semibold tracking-tight" id="title">Signals Performance Terminal</h1>
              <div class="mt-2 flex items-center gap-2">
                <div class="text-xs text-zinc-400" id="subtitle">—</div>
                <span class="text-xs text-emerald-300 hidden" id="livePill">LIVE</span>
              </div>
            </div>
          </div>
        </div>

        <div class="flex flex-wrap items-center gap-2 sm:justify-end">
          <div class="rounded-xl border border-white/10 bg-white/5 px-3 py-2">
            <div class="text-[11px] text-zinc-400">Time range</div>
            <select
              id="range"
              class="mt-1 w-full bg-transparent text-sm font-medium outline-none"
              aria-label="Time range"
            >
              <option value="7d" selected>Last 7 days</option>
              <option value="30d">Last 30 days</option>
            </select>
          </div>

          <div class="rounded-xl border border-white/10 bg-white/5 px-3 py-2">
            <div class="text-[11px] text-zinc-400">Token</div>
            <select id="token" class="mt-1 w-full bg-transparent text-sm font-medium outline-none" aria-label="Token"></select>
          </div>

          <button
            id="toggleLive"
            class="rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-zinc-200 hover:bg-white/10"
            aria-pressed="true"
            title="Pause/resume live demo updates"
          >
            Live
          </button>

          <button
            id="export"
            class="rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-zinc-200 hover:bg-white/10"
          >
            Export CSV
          </button>

          <a href="/" class="rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-zinc-200 hover:bg-white/10">Home</a>
        </div>
      </header>

      <!-- KPI grid -->
      <section class="mt-10 grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        <div class="relative overflow-hidden rounded-2xl border border-white/10 bg-white/5 p-5">
          <div class="absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
          <div class="text-xs uppercase tracking-wider text-zinc-400">Equity (paper)</div>
          <div class="mt-2 text-2xl font-semibold tracking-tight" data-kpi="equity">—</div>
          <div class="mt-1 text-sm text-emerald-300" data-kpi-delta="equity">—</div>
          <svg class="mt-3" width="104" height="28" viewBox="0 0 104 28" data-spark="equity"></svg>
        </div>

        <div class="relative overflow-hidden rounded-2xl border border-white/10 bg-white/5 p-5">
          <div class="absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
          <div class="text-xs uppercase tracking-wider text-zinc-400">Max drawdown</div>
          <div class="mt-2 text-2xl font-semibold tracking-tight" data-kpi="max_drawdown">—</div>
          <div class="mt-1 text-sm text-emerald-300" data-kpi-delta="max_drawdown">—</div>
          <svg class="mt-3" width="104" height="28" viewBox="0 0 104 28" data-spark="drawdown"></svg>
        </div>

        <div class="relative overflow-hidden rounded-2xl border border-white/10 bg-white/5 p-5">
          <div class="absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
          <div class="text-xs uppercase tracking-wider text-zinc-400">Win rate</div>
          <div class="mt-2 text-2xl font-semibold tracking-tight" data-kpi="win_rate">—</div>
          <div class="mt-1 text-sm text-emerald-300" data-kpi-delta="win_rate">—</div>
          <svg class="mt-3" width="104" height="28" viewBox="0 0 104 28" data-spark="win_rate"></svg>
        </div>

        <div class="relative overflow-hidden rounded-2xl border border-white/10 bg-white/5 p-5">
          <div class="absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
          <div class="text-xs uppercase tracking-wider text-zinc-400">Profit factor</div>
          <div class="mt-2 text-2xl font-semibold tracking-tight" data-kpi="profit_factor">—</div>
          <div class="mt-1 text-sm text-emerald-300" data-kpi-delta="profit_factor">—</div>
          <svg class="mt-3" width="104" height="28" viewBox="0 0 104 28" data-spark="equity"></svg>
        </div>
      </section>

      <!-- Main chart + insights -->
      <section class="mt-6 grid gap-6 lg:grid-cols-3">
        <div class="rounded-2xl border border-white/10 bg-white/5 p-6 lg:col-span-2">
          <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
            <div>
              <h2 class="text-lg font-semibold tracking-tight">Equity + Drawdown + Context</h2>
              <p class="mt-1 text-sm text-zinc-400">
                Hover to see values. Toggle series. This is the core story: strategies drive expectancy, expectancy drives equity — and drawdown tells you the cost.
              </p>
            </div>

            <div class="flex flex-wrap items-center gap-2">
              <button class="series-toggle rounded-lg border border-white/10 bg-white/5 px-2 py-1 text-xs text-zinc-300" data-series="equity" aria-pressed="true">Equity</button>
              <button class="series-toggle rounded-lg border border-white/10 bg-transparent px-2 py-1 text-xs text-zinc-500" data-series="drawdown" aria-pressed="true">Drawdown</button>
              <button class="series-toggle rounded-lg border border-white/10 bg-transparent px-2 py-1 text-xs text-zinc-500" data-series="price" aria-pressed="true">Price</button>
              <button class="series-toggle rounded-lg border border-white/10 bg-transparent px-2 py-1 text-xs text-zinc-500" data-series="volume" aria-pressed="true">Volume</button>
              <button class="series-toggle rounded-lg border border-white/10 bg-transparent px-2 py-1 text-xs text-zinc-500" data-series="oi" aria-pressed="true">Open interest</button>
              <button class="series-toggle rounded-lg border border-white/10 bg-transparent px-2 py-1 text-xs text-zinc-500" data-series="win_rate" aria-pressed="true">Win rate</button>
            </div>
          </div>

          <div class="mt-6 overflow-x-auto">
            <div class="relative">
              <svg id="chart" width="920" height="240" viewBox="0 0 920 240" class="block"></svg>
              <div id="tooltip" class="pointer-events-none absolute hidden rounded-xl border border-white/10 bg-black/80 px-3 py-2 text-xs text-zinc-200 backdrop-blur">
                <div class="font-medium" data-tip-title>—</div>
                <div class="mt-1 grid gap-1" data-tip-body></div>
              </div>
            </div>
          </div>

          <div class="mt-6 grid gap-3 sm:grid-cols-2">
            <div class="rounded-xl border border-white/10 bg-black/20 px-4 py-3">
              <div class="text-xs text-zinc-400">What’s working</div>
              <div class="mt-1 text-sm text-zinc-200">
                Referral + social are accelerating. Double down on posts that trigger replies (highest signup lift).
              </div>
            </div>
            <div class="rounded-xl border border-white/10 bg-black/20 px-4 py-3">
              <div class="text-xs text-zinc-400">What to build next</div>
              <div class="mt-1 text-sm text-zinc-200">
                Add “lead magnet → onboarding → upsell” automation and a weekly cohort email. This reduces churn risk.
              </div>
            </div>
          </div>
        </div>

        <aside class="rounded-2xl border border-white/10 bg-white/5 p-6">
          <h3 class="text-lg font-semibold tracking-tight">Retention cohorts (WOW)</h3>
          <p class="mt-1 text-sm text-zinc-400">A cohort heatmap instantly shows whether changes improved retention.</p>

          <div class="mt-5 overflow-hidden rounded-xl border border-white/10 bg-black/20">
            <div class="grid" style="grid-template-columns: 84px repeat(6, 1fr)">
              <div class="p-3 text-[11px] text-zinc-500">Cohort</div>
              {[0, 1, 2, 3, 4, 5].map((i) => (
                <div class="p-3 text-[11px] text-zinc-500 text-center">W{i}</div>
              ))}

              <div id="cohorts" class="contents"></div>
            </div>
          </div>

          <div class="mt-5 rounded-xl border border-white/10 bg-black/20 p-4">
            <div class="text-xs uppercase tracking-wider text-zinc-500">Interpretation</div>
            <p class="mt-2 text-sm text-zinc-200">
              If later cohorts stay brighter longer, your onboarding + product wedge improved stickiness.
              This is the kind of “niche stat” that sells.
            </p>
          </div>
        </aside>
      </section>

      <!-- Table: top creators / influencers -->
      <section class="mt-6 rounded-2xl border border-white/10 bg-white/5 p-6">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
          <div>
            <h3 class="text-lg font-semibold tracking-tight">Top influencers (conversion impact)</h3>
            <p class="mt-1 text-sm text-zinc-400">
              A niche would want this because it tells them who to collaborate with — not just who is loud.
            </p>
          </div>
          <div class="text-xs text-zinc-500">Click headers to sort</div>
        </div>

        <div class="mt-4 overflow-hidden rounded-xl border border-white/10">
          <table class="w-full text-sm" id="top-table">
            <thead class="bg-black/30">
              <tr>
                <th class="px-4 py-3 text-left font-medium text-zinc-400" data-sort="name">Account</th>
                <th class="px-4 py-3 text-right font-medium text-zinc-400" data-sort="followers">Followers</th>
                <th class="px-4 py-3 text-right font-medium text-zinc-400" data-sort="posts">Posts</th>
                <th class="px-4 py-3 text-right font-medium text-zinc-400" data-sort="engagement">Engagement</th>
                <th class="px-4 py-3 text-right font-medium text-zinc-400" data-sort="converts">Win rate</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-white/10" id="top-body"></tbody>
          </table>
        </div>
      </section>

      <footer class="mt-10 border-t border-white/10 pt-6 text-xs text-zinc-500">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
          <div class="text-zinc-500">Public demo · no auth</div>
          <div class="text-zinc-600">© {new Date().getFullYear()} Logentica</div>
        </div>
      </footer>

      <script is:inline>
        const fmt = {
          int: (n) => new Intl.NumberFormat(undefined).format(Math.round(n)),
          pct: (n) => `${n.toFixed(1)}%`,
          money: (n) => new Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(n),
        };

        const state = {
          range: '7d',
          live: true,
          visible: { equity: true, drawdown: true, price: true, volume: true, oi: true, win_rate: true },
          sort: { key: 'converts', dir: 'desc' },
          data: null,
        };

        const els = {
          title: document.getElementById('title'),
          subtitle: document.getElementById('subtitle'),
          livePill: document.getElementById('livePill'),
          toggleLive: document.getElementById('toggleLive'),
          range: document.getElementById('range'),
          token: document.getElementById('token'),
          export: document.getElementById('export'),
          chart: document.getElementById('chart'),
          tip: document.getElementById('tooltip'),
          tipTitle: document.querySelector('[data-tip-title]'),
          tipBody: document.querySelector('[data-tip-body]'),
          // cohorts is legacy (kept for now)
          cohorts: document.getElementById('cohorts'),
          topBody: document.getElementById('top-body'),
          topTable: document.getElementById('top-table'),
        };

        function sparkPath(values, w = 104, h = 28, pad = 2) {
          const min = Math.min(...values);
          const max = Math.max(...values);
          const span = Math.max(1e-9, max - min);
          const step = (w - pad * 2) / (values.length - 1);
          const pts = values.map((v, i) => {
            const x = pad + i * step;
            const y = pad + (1 - (v - min) / span) * (h - pad * 2);
            return [x, y];
          });
          const d = pts.map(([x, y], i) => `${i === 0 ? 'M' : 'L'}${x.toFixed(2)} ${y.toFixed(2)}`).join(' ');
          return { d, pts };
        }

        function setKPI(key, value, deltaPct, sparkValues, formatter) {
          const v = document.querySelector(`[data-kpi="${key}"]`);
          const d = document.querySelector(`[data-kpi-delta="${key}"]`);
          const s = document.querySelector(`[data-spark="${key}"]`);
          if (!v || !d || !s) return;

          v.textContent = formatter(value);

          const rawDelta = typeof deltaPct === 'string' ? deltaPct.trim() : deltaPct;
          const delta =
            typeof rawDelta === 'number'
              ? rawDelta
              : typeof rawDelta === 'string'
                ? Number.parseFloat(rawDelta.replace('%', ''))
                : NaN;

          if (!Number.isFinite(delta)) {
            d.textContent = '—';
            d.classList.remove('text-emerald-300', 'text-rose-300');
            d.classList.add('text-zinc-400');
          } else {
            const sign = delta > 0 ? '+' : '';
            d.textContent = `${sign}${delta.toFixed(1)}% vs prev`;
            d.classList.remove('text-zinc-400');
            d.classList.toggle('text-emerald-300', delta >= 0);
            d.classList.toggle('text-rose-300', delta < 0);
          }

          if (Array.isArray(sparkValues) && sparkValues.length >= 2) {
            const sp = sparkPath(sparkValues);
            s.innerHTML = `
              <path d="${sp.d}" fill="none" stroke="rgba(255,255,255,0.72)" stroke-width="2" stroke-linecap="round"></path>
              <circle cx="${sp.pts[sp.pts.length - 1][0]}" cy="${sp.pts[sp.pts.length - 1][1]}" r="2.6" fill="rgba(255,255,255,0.95)"></circle>
            `;
          } else {
            s.innerHTML = '';
          }
        }

        function drawCohorts(cohorts) {
          const weeks = cohorts.weeks;
          const mat = cohorts.retention;

          const clamp = (x, a, b) => Math.max(a, Math.min(b, x));
          const shade = (p) => {
            const t = clamp(p / 100, 0, 1);
            const a = 0.06 + t * 0.26;
            return `rgba(255,255,255,${a.toFixed(3)})`;
          };

          const rows = [];
          for (let r = 0; r < weeks.length; r++) {
            rows.push(`<div class="p-3 text-[11px] text-zinc-400">${weeks[r]}</div>`);
            for (let c = 0; c < mat[r].length; c++) {
              const val = mat[r][c];
              rows.push(`
                <div
                  class="p-3 text-center text-[11px] text-zinc-200"
                  style="background:${shade(val)}"
                  title="${weeks[r]} · W${c} = ${val}%"
                >
                  ${val}%
                </div>
              `);
            }
          }
          els.cohorts.innerHTML = rows.join('');
        }

        function drawChart(rangeData) {
          const svg = els.chart;
          if (!svg) return;

          const W = 920, H = 240, pad = 18;
          const labels = Array.isArray(rangeData.labels) ? rangeData.labels : [];
          const series = rangeData && rangeData.series && typeof rangeData.series === 'object' ? rangeData.series : {};
          const n = labels.length;
          if (n < 2) {
            svg.innerHTML = '';
            return;
          }
          const step = (W - pad * 2) / (n - 1);

          const vis = state.visible;
          const kinds = Object.keys(vis).filter((k) => vis[k] && Array.isArray(series[k]) && series[k].length >= n);

          const colors = {
            equity: 'rgba(255,255,255,0.92)',
            drawdown: 'rgba(148,163,184,0.75)',
            price: 'rgba(251,191,36,0.72)',
            volume: 'rgba(255,255,255,0.48)',
            oi: 'rgba(56,189,248,0.70)',
            win_rate: 'rgba(16,185,129,0.75)',
          };

          const scales = {};
          for (const kind of kinds) {
            const arr = series[kind].slice(0, n).map((x) => Number(x)).filter((x) => Number.isFinite(x));
            const min = arr.length ? Math.min(...arr) : 0;
            const max = arr.length ? Math.max(...arr) : 1;
            scales[kind] = { min, span: Math.max(1e-9, max - min) };
          }

          function y(v, kind) {
            const inner = H - pad * 2;
            const sc = scales[kind];
            if (!sc) return pad + inner / 2;
            const vv = Number(v);
            if (!Number.isFinite(vv)) return pad + inner / 2;
            return pad + (1 - (vv - sc.min) / sc.span) * inner;
          }

          const grid = [0.25, 0.5, 0.75]
            .map((t) => {
              const yy = pad + t * (H - pad * 2);
              return `<line x1="${pad}" y1="${yy}" x2="${W - pad}" y2="${yy}" stroke="rgba(255,255,255,0.08)" stroke-width="1" />`;
            })
            .join('');

          function poly(kind) {
            const data = series[kind].slice(0, n);
            const pts = data
              .map((v, i) => {
                const xx = pad + i * step;
                const yy = y(v, kind);
                return `${xx},${yy}`;
              })
              .join(' ');
            return { pts };
          }

          const lines = kinds
            .map((kind) => {
              const p = poly(kind);
              return `
                <polyline points="${p.pts}" fill="none" stroke="${colors[kind] || 'rgba(255,255,255,0.55)'}" stroke-width="${kind === 'equity' ? 2.6 : 2.0}" stroke-linecap="round" stroke-linejoin="round" />
              `;
            })
            .join('');

          const dots = labels
            .map((lbl, i) => {
              const xx = pad + i * step;
              const dotBits = kinds
                .map((kind) => {
                  const yy = y(series[kind][i], kind);
                  return `<circle cx="${xx}" cy="${yy}" r="3.0" fill="${colors[kind] || 'rgba(255,255,255,0.55)'}" />`;
                })
                .join('');
              const text = `<text x="${xx}" y="${H - 6}" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.55)">${lbl}</text>`;
              return `<g>${dotBits}${text}</g>`;
            })
            .join('');

          const overlay = `<rect x="${pad}" y="${pad}" width="${W - pad * 2}" height="${H - pad * 2}" fill="transparent" id="overlay" />`;

          svg.innerHTML = `
            <defs>
              <linearGradient id="fade" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="rgba(255,255,255,0.18)" />
                <stop offset="100%" stop-color="rgba(255,255,255,0.00)" />
              </linearGradient>
            </defs>
            ${grid}
            ${lines}
            ${dots}
            ${overlay}
          `;

          const overlayEl = svg.querySelector('#overlay');
          if (!overlayEl) return;

          overlayEl.addEventListener('mousemove', (e) => {
            const rect = svg.getBoundingClientRect();
            const mx = e.clientX - rect.left;
            const idx = Math.round((mx - pad) / step);
            const i = Math.max(0, Math.min(n - 1, idx));

            els.tip.classList.remove('hidden');
            els.tip.style.left = `${Math.min(rect.width - 220, Math.max(12, mx + 12))}px`;
            els.tip.style.top = `12px`;

            els.tipTitle.textContent = `${rangeData.label} · ${labels[i]}`;

            const rows = [];
            const add = (label, value) => rows.push(`<div class="flex items-center justify-between gap-6"><span class="text-zinc-400">${label}</span><span class="font-medium">${value}</span></div>`);

            if (vis.equity && Number.isFinite(Number(series.equity?.[i]))) add('Equity', fmt.money(series.equity[i]));
            if (vis.drawdown && Number.isFinite(Number(series.drawdown?.[i]))) add('Drawdown', `${Number(series.drawdown[i]).toFixed(0)} USD`);
            if (vis.price && Number.isFinite(Number(series.price?.[i]))) add('Price', `$${Number(series.price[i]).toFixed(3)}`);
            if (vis.volume && Number.isFinite(Number(series.volume?.[i]))) add('Volume', `${Number(series.volume[i]).toFixed(1)}M`);
            if (vis.oi && Number.isFinite(Number(series.oi?.[i]))) add('Open interest', `${Math.round(Number(series.oi[i]))}`);
            if (vis.win_rate && Number.isFinite(Number(series.win_rate?.[i]))) add('Win rate', fmt.pct(Number(series.win_rate[i])));
            els.tipBody.innerHTML = rows.join('');
          });

          overlayEl.addEventListener('mouseleave', () => {
            els.tip.classList.add('hidden');
          });
        }

        function renderTopTable(rows) {
          const { key, dir } = state.sort;
          const sorted = [...rows].sort((a, b) => {
            const av = a[key];
            const bv = b[key];
            if (typeof av === 'string') return dir === 'asc' ? av.localeCompare(bv) : bv.localeCompare(av);
            return dir === 'asc' ? av - bv : bv - av;
          });

          els.topBody.innerHTML = sorted
            .map(
              (r) => `
              <tr class="bg-black/10 hover:bg-white/5">
                <td class="px-4 py-3 text-zinc-200">${r.name}</td>
                <td class="px-4 py-3 text-right font-medium text-zinc-100">${fmt.int(r.followers)}</td>
                <td class="px-4 py-3 text-right text-zinc-200">${fmt.int(r.posts)}</td>
                <td class="px-4 py-3 text-right text-zinc-200">${r.engagement.toFixed(1)}</td>
                <td class="px-4 py-3 text-right text-emerald-300">${fmt.int(r.converts)}</td>
              </tr>
            `
            )
            .join('');
        }

        function exportCSV(data, rangeKey) {
          const r = data.ranges[rangeKey];
          const cols = ['metric', ...r.labels];
          const lines = [];
          lines.push(cols.join(','));
          const addRow = (label, arr) => lines.push([label, ...arr].join(','));

          const s = r.series;
          const order = ['equity', 'drawdown', 'price', 'volume', 'oi', 'win_rate'];
          order.forEach((k) => addRow(k, s[k].map((v) => (typeof v === 'number' ? v : String(v)))));

          const blob = new Blob([lines.join('\n')], { type: 'text/csv;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `terminal-${data.meta.primary_token.symbol}-${rangeKey}.csv`;
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
        }

        function render() {
          if (!state.data) return;
          const data = state.data;
          const r = data.ranges[state.range];

          // Title/subtitle
          els.title.textContent = data.meta.title;
          els.subtitle.textContent = `${data.meta.brand} · $${data.meta.primary_token.symbol} (${data.meta.primary_token.chain})`;

          // KPIs
          setKPI('equity', r.kpis.equity.value, r.kpis.equity.delta, r.series.equity.slice(-7), fmt.money);
          setKPI(
            'max_drawdown',
            parseFloat(String(r.kpis.max_drawdown.value).replace('%', '')),
            r.kpis.max_drawdown.delta,
            r.series.drawdown.slice(-7).map((x) => Math.abs(x)),
            (v) => `${v.toFixed(2)}%`
          );
          setKPI(
            'win_rate',
            parseFloat(String(r.kpis.win_rate.value).replace('%', '')),
            r.kpis.win_rate.delta,
            r.series.win_rate.slice(-7).map((x) => x * 100),
            (v) => `${Math.round(v)}%`
          );
          setKPI('profit_factor', r.kpis.profit_factor.value, r.kpis.profit_factor.delta, r.series.equity.slice(-7), (v) => Number(v).toFixed(2));

          // Chart + table
          drawChart({
            label: r.label,
            labels: r.labels,
            series: r.series,
          });

          renderTopTable(data.top_creators);
        }

        // --- Thin adapter layer ---
        // DemoAdapter: loads a static snapshot then mutates it every few seconds to simulate live data.
        // RealAdapter: placeholder; later swap in calls to a real backend (trades/signals/venues).
        class DemoAdapter {
          constructor(url) {
            this.url = url;
          }

          async loadSnapshot() {
            const res = await fetch(this.url, { cache: 'no-store' });
            const snap = await res.json();

            // Normalize ranges for the UI.
            for (const k of Object.keys(snap.ranges)) {
              const r = snap.ranges[k];
              // derive labels from start/end (simple) if not present
              if (!r.labels) {
                const n = r.series.equity.length;
                r.labels = Array.from({ length: n }, (_, i) => (n <= 7 ? ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'][i] || `D${i+1}` : `D${i+1}`));
              }
            }

            // Inject fictional influencer dataset (token callers)
            snap.top_creators = this._makeInfluencers(snap.meta.primary_token.symbol);

            return snap;
          }

          _makeInfluencers(sym) {
            const names = [
              'MoonPilot',
              'SolNomad',
              'CipherQuant',
              'OrbitHedge',
              'ArcLight',
              'DeltaSage',
              'NebulaTrades',
              'KiteSignal',
            ];
            return names.map((n) => {
              const followers = Math.floor(18_000 + Math.random() * 420_000);
              const posts = Math.floor(6 + Math.random() * 60);
              const engagement = 1.2 + Math.random() * 6.5;
              const converts = Math.floor(20 + Math.random() * 900);
              return { name: `${n} (${sym})`, followers, posts, engagement, converts };
            });
          }

          // mutate state in place
          tick(data, rangeKey) {
            const r = data.ranges[rangeKey];
            const s = r.series;

            // random walk helpers
            const jitter = (v, pct) => v * (1 + (Math.random() - 0.5) * pct);

            const lastEq = s.equity[s.equity.length - 1];
            const nextEq = jitter(lastEq, 0.02);
            s.equity.push(nextEq);
            s.equity.shift();

            const lastPrice = s.price[s.price.length - 1];
            const nextPrice = Math.max(0.001, jitter(lastPrice, 0.06));
            s.price.push(nextPrice);
            s.price.shift();

            const lastVol = s.volume[s.volume.length - 1];
            const nextVol = Math.max(1, jitter(lastVol, 0.18));
            s.volume.push(nextVol);
            s.volume.shift();

            const lastOI = s.oi[s.oi.length - 1];
            const nextOI = Math.max(1, jitter(lastOI, 0.08));
            s.oi.push(nextOI);
            s.oi.shift();

            const lastWR = s.win_rate[s.win_rate.length - 1];
            const nextWR = Math.max(0.35, Math.min(0.75, jitter(lastWR, 0.06)));
            s.win_rate.push(nextWR);
            s.win_rate.shift();

            // drawdown: keep it negative-ish and responsive
            const dd = Math.min(0, (nextEq - Math.max(...s.equity)));
            s.drawdown.push(dd);
            s.drawdown.shift();

            // KPIs update
            r.kpis.equity.value = Math.round(nextEq);
            r.kpis.equity.delta = `${(100 * (nextEq / s.equity[0] - 1)).toFixed(1)}%`;

            const ddPct = Math.abs(Math.min(...s.drawdown)) / Math.max(...s.equity) * 100;
            r.kpis.max_drawdown.value = `${ddPct.toFixed(2)}%`;
            r.kpis.max_drawdown.delta = `${(ddPct - parseFloat(String(r.kpis.max_drawdown.value).replace('%',''))).toFixed(2)}%`;

            r.kpis.win_rate.value = `${Math.round(nextWR * 100)}%`;
            r.kpis.win_rate.delta = `${Math.round((nextWR - 0.5) * 100)}%`;

            const pf = 1.05 + Math.random() * 0.9;
            r.kpis.profit_factor.value = Number(pf.toFixed(2));
            r.kpis.profit_factor.delta = `${(Math.random() > 0.5 ? '+' : '-')}${(Math.random() * 0.12).toFixed(2)}`;

            // influencer table: small random movement
            data.top_creators.forEach((x) => {
              x.engagement = Math.max(0.4, x.engagement + (Math.random() - 0.5) * 0.35);
              x.converts = Math.max(0, x.converts + Math.floor((Math.random() - 0.45) * 25));
            });
          }
        }

        class RealAdapter {
          // placeholder: later wire to /api/... or a hosted endpoint
          async loadSnapshot() {
            throw new Error('RealAdapter not configured');
          }
        }

        async function init() {
          // Load a snapshot (demo)
          const adapter = new DemoAdapter('/demo/token_terminal.json');
          state.data = await adapter.loadSnapshot();

          // Fictitious coin swap (demo safety)
          state.data.meta.primary_token = { symbol: 'AURX', name: 'AuroraX', chain: 'Solana' };
          state.data.meta.brand = 'Kestrel Labs';
          state.data.meta.title = 'Signals Performance Terminal';

          // Token selector (universe)
          els.token.innerHTML = state.data.meta.token_universe
            .map((t) => `<option value="${t.symbol}">${t.symbol} · ${t.name}</option>`)
            .join('');
          els.token.value = state.data.meta.primary_token.symbol;
          els.token.addEventListener('change', () => {
            state.data.meta.primary_token.symbol = els.token.value;
            // Refresh influencer labels to match selected token
            state.data.top_creators = adapter._makeInfluencers(els.token.value);
            render();
          });

          els.range.addEventListener('change', () => {
            state.range = els.range.value;
            render();
          });

          document.querySelectorAll('.series-toggle').forEach((btn) => {
            btn.addEventListener('click', () => {
              const key = btn.getAttribute('data-series');
              state.visible[key] = !state.visible[key];
              btn.setAttribute('aria-pressed', String(state.visible[key]));
              btn.classList.toggle('text-zinc-300', state.visible[key]);
              btn.classList.toggle('text-zinc-500', !state.visible[key]);
              btn.classList.toggle('bg-white/5', state.visible[key]);
              btn.classList.toggle('bg-transparent', !state.visible[key]);
              render();
            });
          });

          els.topTable.querySelectorAll('th[data-sort]').forEach((th) => {
            th.style.cursor = 'pointer';
            th.addEventListener('click', () => {
              const key = th.getAttribute('data-sort');
              if (state.sort.key === key) {
                state.sort.dir = state.sort.dir === 'asc' ? 'desc' : 'asc';
              } else {
                state.sort.key = key;
                state.sort.dir = 'desc';
              }
              render();
            });
          });

          els.export.addEventListener('click', () => exportCSV(state.data, state.range));

          // Live updates
          state.live = true;
          els.livePill.classList.remove('hidden');

          const tickEveryMs = 2400;
          let timer = null;
          const start = () => {
            if (timer) return;
            timer = setInterval(() => {
              if (!state.data || !state.live) return;
              adapter.tick(state.data, state.range);
              render();
            }, tickEveryMs);
          };
          const stop = () => {
            if (!timer) return;
            clearInterval(timer);
            timer = null;
          };

          els.toggleLive.addEventListener('click', () => {
            state.live = !state.live;
            els.toggleLive.setAttribute('aria-pressed', String(state.live));
            els.livePill.classList.toggle('hidden', !state.live);
            els.toggleLive.classList.toggle('bg-white/10', state.live);
            els.toggleLive.textContent = state.live ? 'Live' : 'Paused';
          });

          start();
          render();
        }

        init();
      </script>
    </main>
  </body>
</html>
